<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dream House â€¢ Light Blue Atmosphere</title>

  <!-- A-Frame core and extras -->
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>


</head>

<body>
  <!-- A-Frame scene with light blue environment -->
  <a-scene id="dream-scene" vr-mode-ui="enabled: false"
    renderer="colorManagement: true; exposure: 1.2; toneMapping: ACESFilmic; antialias: true; logarithmicDepthBuffer: true"
    background="color: #c6e6ff" fog="type: exponential; color: #c6e6ff; density: 0.002">
    <a-assets>
      <a-asset-item id="dreamModel" src="models/model.glb"></a-asset-item>
      <a-asset-item id="carModel" src="models/2015 Dodge Challenger.glb"></a-asset-item>
    </a-assets>

    <!-- Light blue wireframe environment -->
    <a-entity id="ambient-shell" position="0 0 0">
      <!-- main sky dome -->
      <a-sphere radius="300"
        material="shader: flat; color: #d4ecff; wireframe: true; transparent: true; opacity: 0.2; side: back"></a-sphere>

      <!-- secondary dome for depth -->
      <a-sphere radius="200"
        material="shader: flat; color: #c0e4ff; wireframe: true; transparent: true; opacity: 0.15; side: back"></a-sphere>

      <!-- floating wireframe shapes in light blue tones -->
      <a-entity position="-80 20 -120" rotation="0 45 0">
        <a-torus radius="12" radius-tubular="0.8" material="color: #aad0ff; wireframe: true" opacity="0.4"
          scale="2 2 2"></a-torus>
      </a-entity>

      <a-entity position="150 10 -200">
        <a-icosahedron radius="20" material="color: #7fb4ff; wireframe: true" opacity="0.3"
          scale="1.2 1.2 1.2"></a-icosahedron>
      </a-entity>

      <a-entity position="-200 60 100">
        <a-ring radius-inner="12" radius-outer="18" material="color: #9ac2ff; wireframe: true" opacity="0.25"></a-ring>
      </a-entity>

      <a-entity position="70 -30 250" rotation="30 60 20">
        <a-octahedron radius="15" material="color: #c0e4ff; wireframe: true" opacity="0.25"></a-octahedron>
      </a-entity>

      <a-entity position="-250 -10 -180">
        <a-torus-knot radius="10" radius-tubular="3" material="color: #a1c6ff; wireframe: true" opacity="0.2"
          scale="1.5 1.5 1.5"></a-torus-knot>
      </a-entity>
    </a-entity>

    <!-- dream house model -->
    <a-entity id="character" gltf-model="#dreamModel" animation-mixer water-move position="10 -40 -150"
      rotation="0 -90 0" scale="30 30 30"></a-entity>

    <!-- Car model: 2015 Dodge Challenger -->
    <a-entity id="car" gltf-model="#carModel" position="-300 -18 -100" rotation="0 180 0" scale="13 13 13"></a-entity>

    <!-- Light blue lighting -->
    <a-light type="ambient" intensity="0.7" color="#d0ecff"></a-light>
    <a-light type="directional" intensity="1.2" position="30 40 30" color="#e8f4ff"></a-light>
    <a-light type="directional" intensity="0.8" position="-30 20 -50" color="#b8dcff"></a-light>
    <a-light type="point" intensity="0.5" position="10 30 20" color="#c8e4ff"></a-light>

    <!-- player rig -->
    <a-entity id="player" position="-450 12 -80">
      <a-camera id="main-camera" look-controls="enabled: false" near="0.5"></a-camera>
    </a-entity>
  </a-scene>

  <!-- navigation controller -->
  <script>
    (function () {
      const sceneEl = document.querySelector('a-scene');
      const loadingEl = document.getElementById('loading');

      // component to animate water surfaces if found in models
      AFRAME.registerComponent('water-move', {
        tick: function (t) {
          const speed = 0.0002;
          this.el.object3D.traverse(node => {
            if (node.isMesh) {
              const name = node.name.toLowerCase();
              if (name.includes('water') || name.includes('pool') || name.includes('liquid') || name.includes('ocean')) {
                if (node.material) {
                  // animate diffuse map
                  if (node.material.map) {
                    node.material.map.offset.x += speed * Math.sin(t / 800);
                    node.material.map.offset.y += speed * Math.cos(t / 600);
                  }
                  // animate normal map for more realism
                  if (node.material.normalMap) {
                    node.material.normalMap.offset.x -= speed * 0.5 * Math.cos(t / 700);
                    node.material.normalMap.offset.y -= speed * 0.5 * Math.sin(t / 500);
                  }
                }
              }
            }
          });
        }
      });

      class LightBlueNavigation {
        constructor() {
          this.keys = {};
          this.velocity = new THREE.Vector3(0, 0, 0);
          this.position = new THREE.Vector3(-450, 12, -80);
          this.theta = 4.87; // face the building from further back
          this.phi = 0;
          this.player = document.getElementById('player');
          this.camera = document.getElementById('main-camera');
          this.environmentShell = document.getElementById('ambient-shell');
          this.init();
        }

        init() {
          if (!sceneEl) return;
          sceneEl.addEventListener('loaded', () => {
            if (loadingEl) {
              loadingEl.style.opacity = '0';
              setTimeout(() => { loadingEl.style.display = 'none'; }, 1200);
            }
            this.setupInput();
            this.startLoop();
          });
        }

        setupInput() {
          document.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            this.keys[key] = true;
            if (key === ' ' || key === 'control') e.preventDefault();
          });
          document.addEventListener('keyup', (e) => {
            const key = e.key.toLowerCase();
            this.keys[key] = false;
          });

          document.body.addEventListener('click', () => {
            if (!document.pointerLockElement) {
              document.body.requestPointerLock();
            }
          });

          document.addEventListener('mousemove', (e) => {
            if (document.pointerLockElement) {
              this.theta -= e.movementX * 0.0025;
              this.phi -= e.movementY * 0.0025;
              this.phi = Math.max(-1.4, Math.min(1.4, this.phi));
            }
          });
        }

        startLoop() {
          let lastTime = performance.now();
          const tick = (now) => {
            const dt = Math.min(0.1, (now - lastTime) / 1000);
            lastTime = now;

            const forward = new THREE.Vector3(Math.sin(this.theta), 0, Math.cos(this.theta));
            const right = new THREE.Vector3(Math.sin(this.theta - Math.PI / 2), 0, Math.cos(this.theta - Math.PI / 2));
            const moveDir = new THREE.Vector3(0, 0, 0);

            if (this.keys['w']) moveDir.add(forward.clone().negate());
            if (this.keys['s']) moveDir.add(forward);
            if (this.keys['a']) moveDir.add(right);
            if (this.keys['d']) moveDir.add(right.clone().negate());
            if (this.keys[' ']) moveDir.y += 1;
            if (this.keys['control']) moveDir.y -= 1;

            const speed = this.keys['shift'] ? 45 : 18;
            if (moveDir.lengthSq() > 0) moveDir.normalize().multiplyScalar(speed);

            this.velocity.lerp(moveDir, 0.15);
            this.position.add(this.velocity.clone().multiplyScalar(dt));

            if (this.player) this.player.setAttribute('position', this.position);
            if (this.environmentShell) this.environmentShell.setAttribute('position', this.position);

            if (this.camera?.object3D) {
              this.camera.object3D.quaternion.setFromEuler(new THREE.Euler(this.phi, this.theta, 0, 'YXZ'));
            }

            requestAnimationFrame(tick);
          };
          requestAnimationFrame(tick);
        }
      }

      if (sceneEl) {
        new LightBlueNavigation();
      } else {
        window.addEventListener('DOMContentLoaded', () => {
          new LightBlueNavigation();
        });
      }
    })();
  </script>
</body>

</html>
